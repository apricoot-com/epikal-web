#!/bin/bash

# run script for Epikal Web Development

echo "ðŸš€ Starting Epikal Web Development Environment..."

# 1. Ensure Docker Compose is running
echo "ðŸ³ Checking Docker services..."
if ! docker compose ps | grep "epikal-postgres" > /dev/null; then
    echo "Starting Docker containers..."
    docker compose up -d
    echo "Waiting for database to be ready..."
    # Simple wait loop
    until docker compose exec postgres pg_isready -U epikal -d epikal; do
        echo "Waiting for postgres..."
        sleep 2
    done
    echo "âœ… Database is ready!"
else
    echo "âœ… Docker containers are already running."
fi

# 2. Run Migrations
echo "ðŸ“¦ Running database migrations..."
npm run db:migrate

# 3. Seed Database
echo "ðŸŒ± Seeding database..."
npm run db:seed

# 4. Start Server
echo "ðŸš€ Starting Next.js development server..."
npm run dev
